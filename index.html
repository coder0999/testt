import React, { useState, useEffect, useRef, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, setDoc, getDoc } from 'firebase/firestore';

// Main App Component
function App() {
    // Firebase Configuration - Replace with your actual Firebase config if different
    const firebaseConfig = {
        apiKey: "AIzaSyC3BSf75v3qFs2xm7i-TJksrcEHELEmVpo",
        authDomain: "potato-e7861.firebaseapp.com",
        projectId: "potato-e7861",
        storageBucket: "potato-e7861.firebasestorage.app",
        messagingSenderId: "905443935896",
        appId: "1:905443935896:web:93c9de4305e49bb6ff32ed"
    };

    // State variables
    const [currentUserId, setCurrentUserId] = useState(null);
    const [currentPoints, setCurrentPoints] = useState(0);
    const [activeTab, setActiveTab] = useState('home');
    const [isDarkMode, setIsDarkMode] = useState(false);
    const [message, setMessage] = useState('');
    const [messageType, setMessageType] = useState(''); // 'success' or 'error'

    // Refs for Firebase instances
    const firebaseAppRef = useRef(null);
    const firebaseAuthRef = useRef(null);
    const firebaseDbRef = useRef(null);
    const googleAuthProviderRef = useRef(null);

    // PWA deferred prompt
    const deferredPrompt = useRef(null);

    // --- Firebase Functions ---

    // Function to show a temporary message (success/error)
    const showTemporaryMessage = useCallback((msg, type) => {
        setMessage(msg);
        setMessageType(type);
        setTimeout(() => {
            setMessage('');
            setMessageType('');
        }, 3000); // Message visible for 3 seconds
    }, []);

    // Function to update the displayed points
    const updatePointsDisplay = useCallback(() => {
        const pointsDisplayElement = document.getElementById('points-display');
        if (pointsDisplayElement) {
            if (currentUserId) {
                pointsDisplayElement.textContent = `${currentPoints} ŸÜŸÇÿßÿ∑`;
            } else {
                pointsDisplayElement.textContent = `Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ™ŸÅÿπŸäŸÑ ÿπÿØÿßÿØ ÿßŸÑŸÜŸÇÿßÿ∑`;
            }
        }
    }, [currentUserId, currentPoints]);

    // Function to get user points from Firestore
    const getPoints = useCallback(async () => {
        if (!firebaseDbRef.current || !currentUserId) {
            console.log('getPoints: Firebase DB or currentUserId not available. Setting points to 0.');
            setCurrentPoints(0); // Default to 0 if not logged in
            updatePointsDisplay();
            return;
        }
        const userId = currentUserId;
        const appId = firebaseConfig.projectId;
        const pointsDocRef = doc(firebaseDbRef.current, `artifacts/${appId}/users/${userId}/points`, 'data');
        console.log(`getPoints: Attempting to fetch points for user: ${userId} at path: artifacts/${appId}/users/${userId}/points/data`);

        try {
            const docSnap = await getDoc(pointsDocRef);
            if (docSnap.exists()) {
                setCurrentPoints(docSnap.data().value || 0);
                console.log('getPoints: User points fetched from Firestore:', docSnap.data().value || 0);
            } else {
                // If no points document exists, initialize it to 0
                console.log('getPoints: No points document found. Initializing to 0.');
                await setDoc(pointsDocRef, { value: 0 });
                setCurrentPoints(0);
                console.log('getPoints: Points document created and initialized to 0 for user:', userId);
            }
        } catch (e) {
            console.error('getPoints: Error fetching or initializing user points from Firestore:', e);
            setCurrentPoints(0); // Fallback to 0 on error
        } finally {
            updatePointsDisplay(); // Always update display after attempt
        }
    }, [currentUserId, updatePointsDisplay]);

    // Function to update user points in Firestore
    const updatePoints = useCallback(async (newPoints) => {
        console.log(`updatePoints: Attempting to update points to ${newPoints}. Current User ID: ${currentUserId}`);
        if (!firebaseDbRef.current || !currentUserId) {
            console.warn('updatePoints: Cannot update points: User not logged in or Firebase DB not initialized.');
            return;
        }
        const userId = currentUserId;
        const appId = firebaseConfig.projectId;
        const pointsDocRef = doc(firebaseDbRef.current, `artifacts/${appId}/users/${userId}/points`, 'data');
        console.log(`updatePoints: Updating points for user: ${userId} at path: artifacts/${appId}/users/${userId}/points/data`);

        try {
            await setDoc(pointsDocRef, { value: newPoints }, { merge: true });
            setCurrentPoints(newPoints);
            updatePointsDisplay();
            console.log(`updatePoints: Points updated successfully to ${newPoints} for user: ${userId}`);
            showTemporaryMessage('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success'); // Show success message
        } catch (e) {
            console.error('updatePoints: Error updating user points in Firestore:', e);
            showTemporaryMessage('ŸÅÿ¥ŸÑ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.', 'error'); // Show error message
        }
    }, [currentUserId, updatePointsDisplay, showTemporaryMessage]);

    // Function to simulate adding points and update in Firestore
    const addPoints = useCallback(async (amount) => {
        console.log(`addPoints: Called with amount: ${amount}`);
        if (!currentUserId) {
            console.warn('addPoints: Cannot add points: User not logged in.');
            showTemporaryMessage('Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑.', 'error'); // Show message to user
            return;
        }
        const newTotalPoints = currentPoints + amount;
        console.log(`addPoints: Current points: ${currentPoints}, New total points: ${newTotalPoints}`);
        await updatePoints(newTotalPoints);
        console.log(`addPoints: Points addition process completed.`);
    }, [currentUserId, currentPoints, updatePoints, showTemporaryMessage]);

    // Function to handle Google Sign-in
    const signInWithGoogle = useCallback(async () => {
        if (!firebaseAuthRef.current || !googleAuthProviderRef.current) {
            console.error('Firebase Auth or Provider not initialized.');
            return;
        }
        const provider = new googleAuthProviderRef.current();
        provider.setCustomParameters({
            prompt: 'select_account'
        });
        try {
            await signInWithPopup(firebaseAuthRef.current, provider);
            console.log('Google Sign-in successful.');
        } catch (error) {
            console.error('Error during Google Sign-in:', error);
            if (error.code === 'auth/popup-closed-by-user') {
                console.log('Google Sign-in popup was closed by the user.');
            }
        }
    }, []);

    // Function to handle user sign out
    const signOutUser = useCallback(async () => {
        if (!firebaseAuthRef.current) {
            console.error('Firebase Auth not initialized.');
            return;
        }
        try {
            await signOut(firebaseAuthRef.current);
            console.log('User signed out.');
            setCurrentPoints(0); // Reset points on sign out
            updatePointsDisplay(); // Update display for logged out state
        } catch (error) {
            console.error('Error during sign out:', error);
        }
    }, [updatePointsDisplay]);

    // Function to update the profile UI (JSX rendering)
    const renderProfileUI = useCallback(() => {
        if (currentUserId) {
            const user = firebaseAuthRef.current.currentUser;
            const userName = user?.displayName || user?.email || 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ';
            const userEmail = user?.email ? `<p style="color: var(--secondary-color); font-size: 0.95rem; margin-bottom: 0.5rem;">${user.email}</p>` : '';
            const userPhoto = user?.photoURL ? `<img src="${user.photoURL}" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 1.5rem; border: 3px solid var(--primary-color); box-shadow: 0 4px 8px rgba(0,0,0,0.1);">` : '';

            return (
                <>
                    <div dangerouslySetInnerHTML={{ __html: userPhoto }} /> {/* Using dangerouslySetInnerHTML for image, consider React img tag directly */}
                    <h2 style={{ color: 'var(--primary-color)', fontSize: '1.8rem', marginBottom: '0.5rem' }}>ÿ£ŸáŸÑÿßŸã ÿ®ŸÉÿå {userName}!</h2>
                    <div dangerouslySetInnerHTML={{ __html: userEmail }} />
                    <p style={{ color: 'var(--secondary-color)', fontSize: '0.8rem', marginBottom: '2rem', wordBreak: 'break-all' }}>ŸÖÿπÿ±ŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (UID): <span style={{ fontWeight: 600 }}>{currentUserId}</span></p>
                    <button
                        onClick={signOutUser}
                        style={{ padding: '12px 24px', backgroundColor: '#dc3545', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '1rem', fontFamily: "'Cairo', sans-serif", transition: 'background-color 0.2s ease', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}
                    >
                        ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
                    </button>
                </>
            );
        } else {
            return (
                <>
                    <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6', marginBottom: '2rem' }}>
                        ÿ£ŸÜÿ™ ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ŸÖŸÑŸÅ ÿ¥ÿÆÿµŸä. ŸÇŸÖ ÿßŸÑÿ¢ŸÜ ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£Ÿà ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®.
                    </p>
                    <button
                        onClick={signInWithGoogle}
                        style={{ padding: '12px 24px', backgroundColor: 'var(--primary-color)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '1rem', fontFamily: "'Cairo', sans-serif", transition: 'background-color 0.2s ease', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}
                    >
                        ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¨Ÿàÿ¨ŸÑ
                    </button>
                </>
            );
        }
    }, [currentUserId, signInWithGoogle, signOutUser]);

    // Function to save/update user profile in Firestore
    const saveUserProfile = useCallback(async (user) => {
        if (!firebaseDbRef.current || !user) return;
        const userId = user.uid;
        const appId = firebaseConfig.projectId;
        const userDocRef = doc(firebaseDbRef.current, `artifacts/${appId}/users/${userId}/profile`, 'data');

        const profileData = {
            uid: user.uid,
            displayName: user.displayName || null,
            email: user.email || null,
            photoURL: user.photoURL || null,
            lastLogin: new Date().toISOString()
        };

        try {
            await setDoc(userDocRef, profileData, { merge: true });
            console.log('User profile saved/updated in Firestore:', userId);
        } catch (e) {
            console.error('Error saving user profile to Firestore:', e);
        }
    }, []);

    // --- Effects ---

    // Firebase Initialization and Auth State Listener
    useEffect(() => {
        firebaseAppRef.current = initializeApp(firebaseConfig);
        firebaseAuthRef.current = getAuth(firebaseAppRef.current);
        firebaseDbRef.current = getFirestore(firebaseAppRef.current);
        googleAuthProviderRef.current = GoogleAuthProvider;

        const unsubscribe = onAuthStateChanged(firebaseAuthRef.current, async (user) => {
            setCurrentUserId(user ? user.uid : null);
            console.log('Auth state changed (useEffect):', user ? user.uid : 'No user');
            if (user) {
                await saveUserProfile(user);
                await getPoints();
            } else {
                setCurrentPoints(0);
                updatePointsDisplay();
            }
        });

        return () => unsubscribe(); // Cleanup auth listener on unmount
    }, [saveUserProfile, getPoints, updatePointsDisplay]);

    // Update points display when currentPoints or currentUserId changes
    useEffect(() => {
        updatePointsDisplay();
    }, [currentPoints, currentUserId, updatePointsDisplay]);

    // PWA Installation Logic
    useEffect(() => {
        const handleBeforeInstallPrompt = (e) => {
            e.preventDefault();
            deferredPrompt.current = e;
            const installAppItem = document.getElementById('install-app-item');
            if (installAppItem) {
                installAppItem.style.display = 'flex';
            }
            console.log('beforeinstallprompt event fired.');
        };

        const handleAppInstalled = () => {
            console.log('PWA was installed');
            const installAppItem = document.getElementById('install-app-item');
            if (installAppItem) {
                installAppItem.style.display = 'none';
            }
        };

        window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
        window.addEventListener('appinstalled', handleAppInstalled);

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('Service Worker registration failed: ', registrationError);
                    });
            });
        }

        return () => {
            window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
            window.removeEventListener('appinstalled', handleAppInstalled);
        };
    }, []);

    // Dark Mode Toggle Effect
    useEffect(() => {
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const storedDarkMode = localStorage.getItem('darkMode');

        if (storedDarkMode === 'enabled') {
            setIsDarkMode(true);
            document.body.classList.add('dark-mode');
            if (darkModeToggle) darkModeToggle.checked = true;
        } else {
            setIsDarkMode(false);
            document.body.classList.remove('dark-mode');
            if (darkModeToggle) darkModeToggle.checked = false;
        }

        const handleChange = (e) => {
            if (e.target.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'enabled');
                setIsDarkMode(true);
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'disabled');
                setIsDarkMode(false);
            }
        };

        if (darkModeToggle) {
            darkModeToggle.addEventListener('change', handleChange);
        }

        return () => {
            if (darkModeToggle) {
                darkModeToggle.removeEventListener('change', handleChange);
            }
        };
    }, []); // Empty dependency array means this runs once on mount

    // Swipe functionality for subject content area
    useEffect(() => {
        let startX = 0;
        let endX = 0;
        const swipeThreshold = 50; // Minimum pixels to count as a swipe

        const subjectContentArea = document.getElementById('subject-content-area');
        if (subjectContentArea) {
            const handleTouchStart = (e) => {
                startX = e.touches[0].clientX;
            };

            const handleTouchMove = (e) => {
                endX = e.touches[0].clientX;
            };

            const handleTouchEnd = () => {
                const diffX = startX - endX;

                const subjectContents = Array.from(document.querySelectorAll('.subject-content'));
                const subjectIds = subjectContents.map(content => content.id.replace('-content', ''));

                const activeSubjectContent = document.querySelector('.subject-content.active');
                if (!activeSubjectContent) return;
                const currentSubjectId = activeSubjectContent.id.replace('-content', '');
                const currentIndex = subjectIds.indexOf(currentSubjectId);

                if (Math.abs(diffX) > swipeThreshold) {
                    if (diffX > 0) { // Swiped left (move to next subject in RTL)
                        const nextIndex = (currentIndex + 1) % subjectIds.length;
                        showSubjectContent(subjectIds[nextIndex]);
                    } else { // Swiped right (move to previous subject in RTL)
                        const prevIndex = (currentIndex - 1 + subjectIds.length) % subjectIds.length;
                        showSubjectContent(subjectIds[prevIndex]);
                    }
                }
                startX = 0;
                endX = 0;
            };

            subjectContentArea.addEventListener('touchstart', handleTouchStart);
            subjectContentArea.addEventListener('touchmove', handleTouchMove);
            subjectContentArea.addEventListener('touchend', handleTouchEnd);

            return () => {
                subjectContentArea.removeEventListener('touchstart', handleTouchStart);
                subjectContentArea.removeEventListener('touchmove', handleTouchMove);
                subjectContentArea.removeEventListener('touchend', handleTouchEnd);
            };
        }
    }, [activeTab]); // Re-run if activeTab changes, ensuring listener is on correct element


    // --- UI Logic Functions ---

    const showTab = (id) => {
        setActiveTab(id);

        // Update bottom nav active state
        document.querySelectorAll('.bottom-nav button').forEach(btn => {
            btn.classList.remove('active');
        });
        const navButton = document.querySelector(`.bottom-nav button[onclick="showTab('${id}')"]`);
        if (navButton) {
            navButton.classList.add('active');
        }

        const navBar = document.querySelector('.bottom-nav');
        const backArrow = document.getElementById('back-arrow');
        const pointsDisplay = document.getElementById('points-display');
        const moreMenuContainer = document.querySelector('.more-menu-container');

        const isChildPage = ['profile', 'settings', 'notifications', 'store', 'summaries'].includes(id);

        if (isChildPage) {
            if (navBar) navBar.style.display = 'none';
            if (backArrow) backArrow.style.display = 'block';
            if (id !== 'store' && pointsDisplay) {
                pointsDisplay.style.display = 'none';
            } else if (pointsDisplay) {
                pointsDisplay.style.display = 'flex';
            }
            if (moreMenuContainer) moreMenuContainer.style.display = 'none';
        } else {
            if (navBar) navBar.style.display = 'flex';
            if (backArrow) backArrow.style.display = 'none';
            if (pointsDisplay) pointsDisplay.style.display = 'flex';
            if (moreMenuContainer) moreMenuContainer.style.display = 'block';
        }

        if (id === 'summaries') {
            showSubjectContent('arabic');
        }
    };

    const toggleMoreMenu = () => {
        const dropdown = document.getElementById('more-menu-dropdown');
        if (dropdown) {
            dropdown.classList.toggle('active');
        }
    };

    const showSubjectContent = (subjectId) => {
        document.querySelectorAll('.subject-tab').forEach(tab => {
            tab.classList.remove('active');
        });

        const activeTabElement = document.querySelector(`.subject-tab[onclick="showSubjectContent('${subjectId}')"]`);
        if (activeTabElement) {
            activeTabElement.classList.add('active');
        }

        document.querySelectorAll('.subject-content').forEach(contentDiv => {
            contentDiv.style.display = 'none';
        });

        const contentToShow = document.getElementById(`${subjectId}-content`);
        if (contentToShow) {
            contentToShow.style.display = 'block';
        }
    };

    const installApp = async () => {
        const installEmojiSpan = document.getElementById('install-emoji');
        if (installEmojiSpan) {
            installEmojiSpan.textContent = 'üîÑ';
            installEmojiSpan.classList.add('animate-spin-infinite');

            if (deferredPrompt.current) {
                deferredPrompt.current.prompt();
                const { outcome } = await deferredPrompt.current.userChoice;
                if (outcome === 'accepted') {
                    console.log('User accepted the A2HS prompt');
                    installEmojiSpan.textContent = '‚úÖ';
                    installEmojiSpan.classList.remove('animate-spin-infinite');
                    const installAppItem = document.getElementById('install-app-item');
                    if (installAppItem) {
                        installAppItem.style.display = 'none';
                    }
                } else {
                    console.log('User dismissed the A2HS prompt');
                    installEmojiSpan.textContent = 'üì•';
                    installEmojiSpan.classList.remove('animate-spin-infinite');
                }
                deferredPrompt.current = null;
            } else {
                console.log('PWA installation prompt not available or already shown.');
                installEmojiSpan.textContent = '‚ùå';
                installEmojiSpan.classList.remove('animate-spin-infinite');
                const installAppItem = document.getElementById('install-app-item');
                if (installAppItem) {
                    installAppItem.style.display = 'none';
                }
            }
        }
    };

    return (
        <div className="App">
            <style jsx>{`
                :root {
                    --primary-color: #007bff;
                    --secondary-color: #6c757d;
                    --active-bg: #e6f2ff;
                    --inactive-color: #999;
                    --background-color: #ffffff;
                    --text-color: #212529;
                    --icon-active-fill: #007bff;
                    --border-color: #e9ecef;
                    --card-shadow: rgba(0, 0, 0, 0.08);
                    --dropdown-bg: #ffffff;
                    --dropdown-item-hover: #f1f3f5;
                }

                body.dark-mode {
                    --primary-color: #4da6ff;
                    --secondary-color: #adb5bd;
                    --active-bg: #1e3a5a;
                    --inactive-color: #6c757d;
                    --background-color: #121212;
                    --text-color: #e9e9e9;
                    --icon-active-fill: #4da6ff;
                    --border-color: #2d2d2d;
                    --card-shadow: rgba(0, 0, 0, 0.3);
                    --dropdown-bg: #1e1e1e;
                    --dropdown-item-hover: #2d2d2d;
                }

                body {
                    margin: 0;
                    padding: 0;
                    min-height: 100vh;
                    font-family: 'Cairo', sans-serif;
                    background: var(--background-color);
                    direction: rtl;
                    -webkit-tap-highlight-color: transparent;
                    color: var(--text-color);
                    font-size: 16px;
                    transition: background-color 0.3s ease, color 0.3s ease;
                    overflow-y: auto;
                }

                body::-webkit-scrollbar {
                    display: none;
                }
                body {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }

                #header-bar {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    height: 50px;
                    padding: 0 1.25rem;
                    background-color: var(--background-color);
                    border-bottom: 1px solid var(--border-color);
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
                    position: fixed;
                    top: 0;
                    width: 100%;
                    z-index: 1000;
                }

                #back-arrow {
                    display: none;
                    width: 24px;
                    height: 24px;
                    color: var(--primary-color);
                    cursor: pointer;
                }

                .points-display {
                    background-color: var(--active-bg);
                    color: var(--primary-color);
                    padding: 0.3rem 0.6rem;
                    border-radius: 0.75rem;
                    font-weight: 600;
                    font-size: 0.8rem;
                    margin-left: 1rem;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: opacity 0.3s ease-in-out, background-color 0.3s ease;
                    cursor: pointer;
                    user-select: none;
                }

                .points-display:active {
                    transform: scale(0.95);
                }

                .header-icons-left {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }

                main {
                    padding: 2rem 1.25rem;
                    padding-bottom: 80px;
                    text-align: center;
                    background-color: var(--background-color);
                    min-height: calc(100vh - 70px - 50px);
                    padding-top: calc(50px + 2rem);
                    transition: background-color 0.3s ease;
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }

                main::-webkit-scrollbar {
                    display: none;
                }
                main {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }

                h1 {
                    color: var(--primary-color);
                    font-size: 2rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
                }

                section {
                    display: none;
                }

                section.active {
                    display: block;
                }

                .bottom-nav {
                    position: fixed;
                    bottom: 0;
                    width: 100%;
                    height: 70px;
                    background-color: var(--background-color);
                    display: flex;
                    justify-content: space-around;
                    align-items: center;
                    border-top: 1px solid var(--border-color);
                    border-top-left-radius: 16px;
                    border-top-right-radius: 16px;
                    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
                    z-index: 1000;
                    transition: background-color 0.3s ease, border-top-color 0.3s ease;
                }

                .bottom-nav button {
                    background: none;
                    border: none;
                    color: var(--inactive-color);
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    -webkit-tap-highlight-color: rgba(0,0,0,0);
                    outline: none;
                    padding: 6px 12px;
                    position: relative;
                    transition: all 0.1s ease;
                }

                .bottom-nav button:active {
                    transform: scale(0.95);
                }

                .bottom-nav button.active {
                    color: var(--primary-color);
                }

                .bottom-nav button .icon-container {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 6px 12px;
                    border-radius: 0.5rem;
                    transition: background-color 0.1s ease;
                }

                .bottom-nav button.active .icon-container {
                    background-color: var(--active-bg);
                }

                .bottom-nav button svg {
                    width: 24px;
                    height: 24px;
                    stroke: var(--inactive-color);
                    fill: none;
                    transition: color 0.3s ease, fill 0.3s ease, stroke 0.3s ease;
                }

                .bottom-nav button.active svg {
                    fill: none;
                    stroke: var(--icon-active-fill);
                }

                .bottom-nav button[onclick="showTab('exams')"].active svg,
                .bottom-nav button[onclick="showTab('reviews')"].active svg {
                    fill: var(--icon-active-fill);
                    stroke: var(--icon-active-fill);
                }

                .bottom-nav button[onclick="showTab('exams')"].active svg path[stroke="white"],
                .bottom-nav button[onclick="showTab('exams')"].active svg line[stroke="white"],
                .bottom-nav button[onclick="showTab('exams')"].active svg polyline[stroke="white"],
                .bottom-nav button[onclick="showTab('reviews')"].active svg path[stroke="white"],
                .bottom-nav button[onclick="showTab('reviews')"].active svg line[stroke="white"],
                .bottom-nav button[onclick="showTab('reviews')"].active svg polyline[stroke="white"] {
                    stroke: white;
                }

                .bottom-nav button span {
                    margin-top: 4px;
                }

                .home-cards-container {
                    display: flex;
                    gap: 1rem;
                    justify-content: center;
                    flex-wrap: nowrap;
                }

                .card {
                    width: 40%;
                    min-width: 120px;
                    aspect-ratio: 1 / 1;
                    border-radius: 12px;
                    box-shadow: 0 4px 8px var(--card-shadow);
                    position: relative;
                    padding: 1rem;
                    text-align: right;
                    cursor: pointer;
                    transition: transform 0.1s ease-in-out, box-shadow 0.3s ease;
                    user-select: none;
                    -webkit-user-select: none;
                    -moz-user-select: none;
                }

                .card:active {
                    transform: scale(0.97);
                }

                .card-title {
                    font-size: 1.25rem;
                    font-weight: 600;
                    color: white;
                    position: absolute;
                    top: 1rem;
                    right: 1rem;
                }

                .card-description {
                    font-size: 0.85rem;
                    color: rgba(255, 255, 255, 0.8);
                    position: absolute;
                    top: 3.5rem;
                    right: 1rem;
                }

                .card svg {
                    position: absolute;
                    bottom: 1rem;
                    left: 1rem;
                    width: 36px;
                    height: 36px;
                }

                .store-card {
                    background-color: #FFD700;
                }

                .summaries-card {
                    background-color: #00A693;
                }

                .settings-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    background-color: var(--background-color);
                    padding: 1rem 1.5rem;
                    border-radius: 12px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                    transition: background-color 0.3s ease;
                    margin-bottom: 1rem;
                }

                .settings-item span {
                    font-size: 1rem;
                    color: var(--text-color);
                }

                .switch {
                    position: relative;
                    display: inline-block;
                    width: 50px;
                    height: 28px;
                }

                .switch input {
                    opacity: 0;
                    width: 0;
                    height: 0;
                }

                .slider {
                    position: absolute;
                    cursor: pointer;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background-color: #ccc;
                    transition: .4s;
                    border-radius: 28px;
                }

                .slider:before {
                    position: absolute;
                    content: "";
                    height: 20px;
                    width: 20px;
                    left: 4px;
                    bottom: 4px;
                    background-color: white;
                    transition: .4s;
                    border-radius: 50%;
                }

                input:checked + .slider {
                    background-color: var(--primary-color);
                }

                input:checked + .slider:before {
                    transform: translateX(22px);
                }

                .more-menu-container {
                    position: relative;
                    cursor: pointer;
                    margin-left: 1rem;
                }

                #more-menu-icon {
                    width: 24px;
                    height: 24px;
                    color: var(--secondary-color);
                    stroke: currentColor;
                    fill: none;
                    transition: transform 0.1s ease-in-out;
                }

                #more-menu-icon:active {
                    transform: scale(0.9);
                }

                #more-menu-dropdown {
                    display: none;
                    position: absolute;
                    top: 45px;
                    right: auto;
                    left: 0;
                    min-width: 150px;
                    background-color: var(--dropdown-bg);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    z-index: 1001;
                    padding: 8px 0;
                    text-align: right;
                }

                #more-menu-dropdown.active {
                    display: block;
                }

                .dropdown-item {
                    display: block;
                    padding: 10px 16px;
                    color: var(--text-color);
                    text-decoration: none;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                }

                .dropdown-item:active {
                    background-color: var(--active-bg);
                }

                .subject-tabs-container {
                    display: flex;
                    overflow-x: auto;
                    padding-bottom: 8px;
                    margin-bottom: 1rem;
                    gap: 8px;
                    justify-content: flex-start;
                    padding-right: 1.25rem;
                    padding-left: 1.25rem;
                    margin-right: -1.25rem;
                    margin-left: -1.25rem;
                }

                .subject-tab {
                    position: relative;
                    flex-shrink: 0;
                    width: 140px;
                    height: 60px;
                    padding: 0;
                    border-radius: 12px;
                    font-size: 1rem;
                    font-weight: 500;
                    text-align: center;
                    cursor: pointer;
                    user-select: none;
                    -webkit-user-select: none;
                    -moz-user-select: none;
                    background-color: var(--background-color);
                    color: var(--text-color);
                    box-shadow: 0 2px 4px var(--card-shadow);
                    transition: background-color 0.3s ease, color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    border: 1px solid var(--border-color);
                }

                .subject-tab:active {
                    transform: scale(0.97);
                }

                .subject-tab.active {
                    background-color: var(--primary-color);
                    color: #ffffff;
                    border-color: var(--primary-color);
                }
                .subject-tab.active .subject-icon-bg svg {
                    fill: #ffffff;
                }
                .subject-tab .subject-icon-bg svg {
                    fill: var(--inactive-color);
                }
                body.dark-mode .subject-tab .subject-icon-bg svg {
                    fill: var(--secondary-color);
                }

                .subject-tab .subject-icon-bg {
                    position: absolute;
                    inset: 0;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    opacity: 0.08;
                    transition: opacity 0.3s ease;
                }

                .subject-tab.active .subject-icon-bg {
                    opacity: 0.15;
                }

                .subject-tab .subject-icon-bg svg {
                    width: 60px;
                    height: 60px;
                    stroke: none;
                }

                .subject-tab span {
                    position: relative;
                    z-index: 1;
                    padding: 0 16px;
                    font-weight: 700;
                }

                .subject-content-area {
                    background-color: var(--active-bg);
                    padding: 1.5rem;
                    border-radius: 8px;
                    text-align: right;
                    min-height: 150px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow-x: hidden;
                    position: relative;
                }

                @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
                }

                .animate-spin-infinite {
                  animation: spin 1s linear infinite;
                }

                .scrollbar-hide::-webkit-scrollbar {
                    display: none;
                }
                .scrollbar-hide {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
            `}</style>

            <header id="header-bar">
                <div className="header-icons-left">
                    <svg id="back-arrow" onClick={() => showTab('home')} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="feather feather-arrow-right" style={{ display: activeTab !== 'home' && !['exams', 'reviews'].includes(activeTab) ? 'block' : 'none' }}>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                    <div className="points-display" id="points-display" onClick={() => showTab('store')}></div>
                </div>

                <div className="more-menu-container" style={{ display: ['home', 'exams', 'reviews'].includes(activeTab) ? 'block' : 'none' }}>
                    <svg id="more-menu-icon" onClick={toggleMoreMenu} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="feather feather-more-vertical">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="12" cy="5" r="1"></circle>
                        <circle cx="12" cy="19" r="1"></circle>
                    </svg>
                    <div id="more-menu-dropdown" className="">
                        <a className="dropdown-item" onClick={() => { showTab('profile'); toggleMoreMenu(); }}>ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</a>
                        <a className="dropdown-item" onClick={() => { showTab('settings'); toggleMoreMenu(); }}>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</a>
                        <a className="dropdown-item" onClick={() => { showTab('notifications'); toggleMoreMenu(); }}>ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</a>
                    </div>
                </div>
            </header>

            {message && (
                <div style={{
                    position: 'fixed',
                    top: '60px',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    padding: '10px 20px',
                    borderRadius: '8px',
                    color: 'white',
                    fontFamily: "'Cairo', sans-serif",
                    fontSize: '0.9rem',
                    zIndex: 10000,
                    opacity: 1, // Controlled by state
                    transition: 'opacity 0.5s ease-in-out',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                    backgroundColor: messageType === 'success' ? '#28a745' : '#dc3545'
                }}>
                    {message}
                </div>
            )}

            <main>
                <section id="home" className={activeTab === 'home' ? 'active' : ''}>
                    <div className="home-cards-container">
                        <a className="card summaries-card" onClick={() => showTab('summaries')}>
                            <h2 className="card-title">ÿßŸÑŸÖŸÑÿÆÿµÿßÿ™</h2>
                            <p className="card-description">ÿ¨ŸÖŸäÿπ ŸÖŸÑÿÆÿµÿßÿ™ ÿßŸÑŸÖŸàÿßÿØ ÿ®ŸÖŸÑÿ≠ŸÇÿßÿ™Ÿáÿß</p>
                            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                                <line x1="10" y1="6" x2="16" y2="6"></line>
                                <line x1="10" y1="10" x2="16" y2="10"></line>
                                <line x1="10" y1="14" x2="16" y2="14"></line>
                            </svg>
                        </a>
                        <a className="card store-card" onClick={() => showTab('store')}>
                            <h2 className="card-title">ÿßŸÑŸÖÿ™ÿ¨ÿ±</h2>
                            <p className="card-description">ÿ™ŸÇÿØÿ± ÿ≥ÿ™ÿ®ÿØŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸáŸÜÿß</p>
                            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                        </a>
                    </div>
                </section>

                <section id="exams" className={activeTab === 'exams' ? 'active' : ''}>
                    <h1>ÿ£ŸáŸÑÿßŸã ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™</h1>
                </section>

                <section id="reviews" className={activeTab === 'reviews' ? 'active' : ''}>
                    <h1>ÿ£ŸáŸÑÿßŸã ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</h1>
                </section>

                <section id="profile" className={activeTab === 'profile' ? 'active' : ''}>
                    <h1 style={{ marginBottom: '2rem' }}>ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</h1>
                    <div id="profile-content-area" style={{ backgroundColor: 'var(--active-bg)', padding: '1.5rem', borderRadius: '8px', textAlign: 'center', minHeight: '150px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', boxShadow: '0 4px 8px var(--card-shadow)' }}>
                        {renderProfileUI()}
                    </div>
                </section>

                <section id="store" className={activeTab === 'store' ? 'active' : ''}>
                    <h1>ÿ£ŸáŸÑÿßŸã ŸÅŸä ÿßŸÑŸÖÿ™ÿ¨ÿ±</h1>
                    <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6', marginTop: '1rem' }}>ŸáŸÜÿß ÿ≥ÿ™ÿ¨ÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ¥ÿ±ÿßÿ° ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜŸÇÿßÿ∑.</p>
                    <button onClick={() => addPoints(10)} style={{ marginTop: '2rem', padding: '10px 20px', backgroundColor: 'var(--primary-color)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }}>
                        ÿ•ÿ∂ÿßŸÅÿ© 10 ŸÜŸÇÿßÿ∑ (ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ©)
                    </button>
                </section>

                <section id="summaries" className={activeTab === 'summaries' ? 'active' : ''}>
                    <div className="subject-tabs-container scrollbar-hide">
                        <button className={`subject-tab ${document.getElementById('arabic-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('arabic')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 18H5V8h14v10zm-1-9H6v8h12V9zm-1-6H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 10h6v2H9v-2zm0 3h6v2H9v-2z" />
                                </svg>
                            </div>
                            <span>ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('english-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('english')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2 0V4.07c3.95.49 7 3.85 7 7.93s-3.05 7.44-7 7.93z" />
                                </svg>
                            </div>
                            <span>ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('physics-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('physics')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v4h-2zm0 6h2v2h-2z"/>
                                </svg>
                            </div>
                            <span>ŸÅŸäÿ≤Ÿäÿß</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('chemistry-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('chemistry')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3zm12-6h-6c-1.1 0-2 .9-2 2v5c0 .55.45 1 1 1h7c.55 0 1-.45 1-1V9c0-1.1-.9-2-2-2zm-2 4h-3V9h3v2zM1 1v22h22V1H1zm20 20H3V3h18v18z" />
                                </svg>
                            </div>
                            <span>ŸÉŸäŸÖŸäÿß</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('pure-math-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('pure-math')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
                                </svg>
                            </div>
                            <span>ÿßŸÑÿ®ÿ≠ÿ™ÿ©</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('applied-math-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('applied-math')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z"/>
                                </svg>
                            </div>
                            <span>ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ©</span>
                        </button>
                        <button className={`subject-tab ${document.getElementById('history-content')?.style.display !== 'none' ? 'active' : ''}`} onClick={() => showSubjectContent('history')}>
                            <div className="subject-icon-bg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 4H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-1 16H6V6h12v14zM9 8h6v2H9V8zm0 3h6v2H9v-2zm0 3h4v2H9v-2z"/>
                                </svg>
                            </div>
                            <span>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</span>
                        </button>
                    </div>

                    <div className="subject-content-area" id="subject-content-area">
                        <div id="arabic-content" className={document.getElementById('arabic-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÜÿ≠Ÿàÿå ÿßŸÑÿµÿ±ŸÅÿå ÿßŸÑÿ®ŸÑÿßÿ∫ÿ©ÿå ŸàÿßŸÑÿ£ÿØÿ®. Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ŸÇŸàÿßÿπÿØ ÿßŸÑÿ•ÿπÿ±ÿßÿ®ÿå ÿ™ÿµÿ±ŸäŸÅ ÿßŸÑÿ£ŸÅÿπÿßŸÑÿå ŸÅŸÜŸàŸÜ ÿßŸÑÿ®ŸÑÿßÿ∫ÿ© ŸÖÿ´ŸÑ ÿßŸÑÿ™ÿ¥ÿ®ŸäŸá ŸàÿßŸÑÿßÿ≥ÿ™ÿπÿßÿ±ÿ©ÿå Ÿàÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿµŸàÿµ ÿßŸÑÿ£ÿØÿ®Ÿäÿ©.</p>
                        </div>
                        <div id="english-content" className={document.getElementById('english-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ© ÿ™ÿ∫ÿ∑Ÿä ÿßŸÑŸÇŸàÿßÿπÿØÿå ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ÿå ŸàŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©. ÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©ÿå ÿ®ŸÜÿßÿ° ÿßŸÑÿ¨ŸÖŸÑÿå ÿ™Ÿàÿ≥Ÿäÿπ ÿßŸÑŸÖŸÅÿ±ÿØÿßÿ™ÿå ŸàŸÉÿ™ÿßÿ®ÿ© ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™ ŸàÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ.</p>
                        </div>
                        <div id="physics-content" className={document.getElementById('physics-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑŸÅŸäÿ≤Ÿäÿßÿ° ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ŸÇŸàÿßŸÜŸäŸÜ ÿßŸÑÿ≠ÿ±ŸÉÿ©ÿå ÿßŸÑÿ∑ÿßŸÇÿ©ÿå ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ°ÿå ŸàÿßŸÑŸÖÿ∫ŸÜÿßÿ∑Ÿäÿ≥Ÿäÿ©. ÿ™ÿ™ŸÜÿßŸàŸÑ ÿßŸÑŸÖŸÅÿßŸáŸäŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÖÿ´ŸÑ ÿßŸÑŸÇŸàÿ©ÿå ÿßŸÑÿ¥ÿ∫ŸÑÿå ÿßŸÑŸÇÿØÿ±ÿ©ÿå ŸàÿßŸÑÿØŸàÿßÿ¶ÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©.</p>
                        </div>
                        <div id="chemistry-content" className={document.getElementById('chemistry-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑŸÉŸäŸÖŸäÿßÿ° ÿ™ÿ¥ŸÖŸÑ ÿ®ŸÜŸäÿ© ÿßŸÑÿ∞ÿ±ÿ©ÿå ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿØŸàÿ±Ÿäÿå ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿäÿ©ÿå ŸàÿßŸÑÿ™ŸÅÿßÿπŸÑÿßÿ™ ÿßŸÑŸÉŸäŸÖŸäÿßÿ¶Ÿäÿ© ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©. Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑÿ£ÿ≠ŸÖÿßÿ∂ ŸàÿßŸÑŸÇŸàÿßÿπÿØÿå ŸàÿßŸÑÿ£ŸÉÿ≥ÿØÿ© ŸàÿßŸÑÿßÿÆÿ™ÿ≤ÿßŸÑ.</p>
                        </div>
                        <div id="pure-math-content" className={document.getElementById('pure-math-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑÿ®ÿ≠ÿ™ÿ© ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿßŸÑÿ¨ÿ®ÿ± ŸàÿßŸÑŸáŸÜÿØÿ≥ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑŸäÿ© Ÿàÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÅÿßÿ∂ŸÑ ŸàÿßŸÑÿ™ŸÉÿßŸÖŸÑ. ÿ™ÿ™ŸÜÿßŸàŸÑ ÿßŸÑŸÖŸÅÿßŸáŸäŸÖ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ© ÿßŸÑŸÖÿ¨ÿ±ÿØÿ© Ÿàÿ™ÿ∑ÿ®ŸäŸÇÿßÿ™Ÿáÿß ÿßŸÑŸÜÿ∏ÿ±Ÿäÿ©.</p>
                        </div>
                        <div id="applied-math-content" className={document.getElementById('applied-math-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© ÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÖŸäŸÉÿßŸÜŸäŸÉÿß ŸàÿßŸÑÿ•ÿ≠ÿµÿßÿ° ŸàÿßŸÑÿßÿ≠ÿ™ŸÖÿßŸÑÿßÿ™. ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖŸÅÿßŸáŸäŸÖ ÿßŸÑÿ±Ÿäÿßÿ∂Ÿäÿ© ŸÑÿ≠ŸÑ ÿßŸÑŸÖÿ¥ŸÉŸÑÿßÿ™ ÿßŸÑŸàÿßŸÇÿπŸäÿ©.</p>
                        </div>
                        <div id="history-content" className={document.getElementById('history-content')?.style.display !== 'none' ? 'subject-content active' : 'subject-content'} style={{ display: 'none' }}>
                            <p style={{ color: 'var(--text-color)', fontSize: '1.1rem', lineHeight: '1.6' }}>ŸÖŸÑÿÆÿµÿßÿ™ ŸÖÿßÿØÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ™ÿ∫ÿ∑Ÿä ÿßŸÑŸÅÿ™ÿ±ÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿßŸÑŸáÿßŸÖÿ©ÿå ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©ÿå ŸàÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™ ÿßŸÑŸÖÿ§ÿ´ÿ±ÿ©. ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ŸÅŸáŸÖ ÿßŸÑÿ™ÿ∑Ÿàÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ∂ÿßÿ±Ÿäÿ© ŸàÿßŸÑÿ≥Ÿäÿßÿ≥Ÿäÿ©.</p>
                        </div>
                    </div>
                </section>

                <section id="settings" className={activeTab === 'settings' ? 'active' : ''}>
                    <h1 style={{ marginBottom: '2rem' }}>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</h1>
                    <div className="settings-item">
                        <span>ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ</span>
                        <label className="switch">
                            <input type="checkbox" id="dark-mode-toggle" onChange={(e) => {
                                if (e.target.checked) {
                                    document.body.classList.add('dark-mode');
                                    localStorage.setItem('darkMode', 'enabled');
                                    setIsDarkMode(true);
                                } else {
                                    document.body.classList.remove('dark-mode');
                                    localStorage.setItem('darkMode', 'disabled');
                                    setIsDarkMode(false);
                                }
                            }} />
                            <span className="slider"></span>
                        </label>
                    </div>
                    <div className="settings-item" id="install-app-item" style={{ display: 'none' }}>
                        <span>ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</span>
                        <button onClick={installApp} id="install-button-emoji" style={{ background: 'none', border: 'none', padding: 0, cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                            <span id="install-emoji" style={{ fontSize: '24px', transition: 'transform 0.3s ease' }}>üì•</span>
                        </button>
                    </div>
                </section>

                <section id="notifications" className={activeTab === 'notifications' ? 'active' : ''}>
                    <h1>ÿ£ŸáŸÑÿßŸã ŸÅŸä ÿµŸÅÿ≠ÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h1>
                </section>
            </main>

            <nav className="bottom-nav" style={{ display: ['home', 'exams', 'reviews'].includes(activeTab) ? 'flex' : 'none' }}>
                <button onClick={() => showTab('home')} className={activeTab === 'home' ? 'active' : ''}>
                    <div className="icon-container">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <path d="M9 22V12h6v10"></path>
                        </svg>
                    </div>
                    <span>ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
                </button>
                <button onClick={() => showTab('exams')} className={activeTab === 'exams' ? 'active' : ''}>
                    <div className="icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z" fill="currentColor"></path>
                            <polyline points="14 2 14 8 20 8" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></line>
                            <line x1="16" y1="17" x2="8" y2="17" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></line>
                            <line x1="10" y1="9" x2="8" y2="9" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></line>
                        </svg>
                    </div>
                    <span>ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™</span>
                </button>
                <button onClick={() => showTab('reviews')} className={activeTab === 'reviews' ? 'active' : ''}>
                    <div className="icon-container">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" fill="currentColor"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" fill="currentColor"></path>
                            <path d="M12 3v18" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                            <path d="M7 7h-5" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                            <path d="M17 7h5" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"></path>
                        </svg>
                    </div>
                    <span>ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</span>
                </button>
            </nav>
        </div>
    );
}

export default App;
